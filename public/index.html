<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LCGPT â€” Local Context Chat</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div id="app">
    <header class="topbar">
      <div class="brand">
        <button id="sidebarToggle" class="icon-btn" title="Toggle sidebar" aria-label="Toggle sidebar" aria-pressed="false">â˜°</button>
        <span class="brand-name">LCGPT</span>
      </div>
      <div class="status">
        <span id="rateStatus" class="badge" title="Current API rate limits" style="margin-right:8px; display:none;">Limits: â€¦</span>
        <span id="usageStatus" class="badge" title="Token usage in this session" style="margin-right:8px; display:none;">Usage: 0</span>
        <span id="healthStatus" class="badge" style="margin-right:8px;">Checkingâ€¦</span>
        <button id="logsToggle" class="icon-btn" title="Toggle API call log panel" aria-label="Toggle logs" aria-pressed="false">ðŸ§¾</button>
      </div>
    </header>

    <main class="layout">
      <section class="left-pane">
        <div class="section">
          <h2>System Prompt</h2>
          <textarea id="systemPrompt" rows="8" placeholder="Enter a system prompt to steer the assistant..."></textarea>
          <div class="controls">
            <input type="text" id="promptName" placeholder="Name to save" />
            <button id="savePromptBtn">Save</button>
            <button id="setDefaultBtn" title="Set current system prompt as default for new conversations">Set default</button>
            <button id="analyzePromptBtn" title="Ask the model to analyze and improve this system prompt">Suggest</button>
          </div>
          <div id="promptAnalysisModal" class="modal" style="display:none;">
            <div class="modal-content">
              <div class="modal-header">
                <h3>System Prompt Review</h3>
                <button id="promptAnalysisClose" class="icon-btn" title="Close">Ã—</button>
              </div>
              <div id="promptAnalysisBody" class="modal-body">
                <div class="empty">Preparingâ€¦</div>
              </div>
              <div class="modal-footer">
                <button id="applyImprovedPromptBtn" title="Replace the textarea with the improved prompt">Apply</button>
                <button id="appendImprovedPromptBtn" title="Append improved prompt below current">Insert</button>
                <button id="copyImprovedPromptBtn" title="Copy improved prompt to clipboard">Copy</button>
              </div>
            </div>
          </div>
        </div>
        <div class="section">
          <h2>Saved Prompts</h2>
          <div id="promptsList" class="prompt-list"></div>
        </div>
        <div class="section">
          <h2>Settings</h2>
          <div class="model-picker">
            <label class="model-label">Model:</label>
            <div class="model-search-row">
              <input id="modelSearch" type="text" placeholder="Quick search modelsâ€¦" aria-label="Search models" />
              <button id="modelSearchClear" class="icon-btn" title="Clear model search" aria-label="Clear model search" style="min-width:36px;">Ã—</button>
            </div>
            <select id="modelSelect"></select>
          </div>
          <div id="reasoningRow" class="reasoning-row" style="display:none; margin-top:8px;">
            <label>
              Reasoning effort:
              <select id="reasoningSelect">
                <option value="off">Off</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>
            </label>
          </div>
        </div>
        <div class="section" id="dailyConvsSection">
          <h2 style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
            <span>Daily Conversations</span>
            <button id="toggleDailyConvs" class="icon-btn" title="Show/Hide" aria-pressed="false">Show</button>
          </h2>
          <div id="dailyConvsInner" style="display:none;">
            <div class="controls" style="margin-top:0; flex-wrap: wrap;">
              <input type="date" id="convDate" />
              <input type="text" id="convSearch" placeholder="Search keywordsâ€¦" />
              <button id="convSearchClear" class="icon-btn" title="Clear search">Ã—</button>
            </div>
            <div class="controls conv-actions" style="margin-top:6px; flex-wrap: wrap;">
              <div class="left">
                <label class="chk"><input type="checkbox" id="convSelectAll" /> Select all</label>
              </div>
              <div class="right" style="display:flex; gap:8px;">
                <button id="convImportBtn" title="Import conversations from JSON">Importâ€¦</button>
                <input id="convImportInput" type="file" accept="application/json,.json" style="display:none;" />
                <button id="convExportBtn" title="Export selected conversations to JSON" disabled>Export selected</button>
                <button id="convDeleteBtn" title="Delete selected conversations" disabled>Delete selected</button>
                <button id="convRefreshBtn" title="Refresh list">Refresh</button>
              </div>
            </div>
            <div id="dailyConvsList" class="conv-list"></div>
          </div>
        </div>
      </section>

      <section class="chat-pane">
        <div id="messages" class="messages"></div>
        <div class="composer">
          <div class="composer-row">
            <textarea id="userInput" rows="2" placeholder="Type your message. Shift+Enter for newline..."></textarea>
          </div>
          <div class="composer-actions">
            <div class="left-actions">
              <span id="contextInfo" class="badge" title="Messages currently sent as context to the model">Context: 0</span>
              <button id="attachBtn" class="icon-btn" title="Attach files (text only)">+</button>
              <input id="fileInput" type="file" multiple style="display:none" />
              <div id="attachments" class="attachments"></div>
            </div>
            <div class="right-actions">
              <button id="newConvBtn" title="Start a fresh conversation (keeps saved prompts)">New conversation</button>
              <button id="saveConvBtn" title="Save this conversation to disk">Save conversation</button>
              <button id="clearContextBtn" title="Stop sending previous messages as context (keeps transcript visible)">Clear context</button>
              <button id="sendBtn">Send</button>
            </div>
          </div>
        </div>
      </section>

      <section class="right-pane">
        <div class="logs-header">
          <h2>API Calls</h2>
          <div class="logs-actions">
            <div class="logs-filters" title="Filter which calls are shown in the log">
              <label class="chk" style="user-select:none;"><input type="checkbox" id="logsFilterExternal" /> External</label>
              <label class="chk" style="user-select:none;"><input type="checkbox" id="logsFilterServer" /> Backend</label>
            </div>
            <button id="clearLogsBtn" title="Clear server log buffer">Clear</button>
          </div>
        </div>
        <div id="logsList" class="logs-list"></div>
      </section>
    </main>
  </div>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
  <script src="/app.js"></script>
</body>
</html>
